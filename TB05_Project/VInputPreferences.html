<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Volunteer Input Preferences</title>
        <link href="TB05css.css" rel="stylesheet">
    </head>
    <body>
        <header>
            <h1>Volunteer Preferences</h1>
        </header>
        <h3>Select Your Roles and Availability</h3>

        <div class="schedule" id="schedule"></div>
        <button id="submit" class="timetable-submit-btn">Submit Preferences</button>

        <script>
            const scheduleContainer = document.getElementById('schedule');
            const submitButton = document.getElementById('submit');

            // Store selected preferences
            let selectedRoles = [];

            // Days and roles
            const days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];
            let roles = []; // Roles will be fetched dynamically from a CSV file
            const startHour = 8; // Default start time
            const endHour = 18; // Default end time

            // Fetch roles from roles.csv
            async function fetchRoles() {
                try {
                    const response = await fetch('roles.csv');
                    if (!response.ok) {
                        throw new Error(`Error fetching roles.csv: ${response.statusText}`);
                    }

                    const text = await response.text();
                    roles = text.split(/\r?\n/).map(line => line.trim()).filter(line => line);

                    if (roles.length === 0) {
                        throw new Error('roles.csv is empty or invalid.');
                    }

                    generateSchedule();
                } catch (error) {
                    scheduleContainer.innerHTML = `<p style="text-align: center; color: red;">${error.message}</p>`;
                    console.error(error.message);
                }
            }

            // Generate the schedule
            function generateSchedule() {
                scheduleContainer.innerHTML = ''; // Clear the container
                selectedRoles = []; // Reset selections

                // Generate headers
                scheduleContainer.appendChild(createHeaderCell("TIME/DAY"));
                days.forEach(day => scheduleContainer.appendChild(createHeaderCell(day)));

                // Generate time slots
                for (let hour = startHour; hour < endHour; hour++) {
                    const currentHour = `${String(hour).padStart(2, '0')}:00`;
                    const nextHour = `${String((hour + 1) % 24).padStart(2, '0')}:00`;

                    // Add time column
                    scheduleContainer.appendChild(createTimeCell(`${currentHour}-${nextHour}`));

                    // Add cells for each day
                    days.forEach(day => {
                        const cell = document.createElement('div');
                        cell.classList.add('schedule-cell');

                        // Add roles within the cell
                        roles.forEach(role => {
                            const roleElement = document.createElement('span');
                            roleElement.textContent = role;
                            roleElement.classList.add('role-item');
                            roleElement.dataset.day = day;
                            roleElement.dataset.time = `${currentHour}-${nextHour}`;
                            roleElement.dataset.role = role;

                            // Toggle selection
                            roleElement.addEventListener('click', () => {
                                const roleKey = `${roleElement.dataset.day}|${roleElement.dataset.time}|${roleElement.dataset.role}`;
                                if (roleElement.classList.contains('selected')) {
                                    roleElement.classList.remove('selected');
                                    selectedRoles = selectedRoles.filter(r => r !== roleKey);
                                } else {
                                    roleElement.classList.add('selected');
                                    selectedRoles.push(roleKey);
                                }
                            });

                            cell.appendChild(roleElement);
                        });

                        scheduleContainer.appendChild(cell);
                    });
                }

                // Apply grid styling
                scheduleContainer.style.gridTemplateColumns = `repeat(${days.length + 1}, 1fr)`; // +1 for time column
                scheduleContainer.style.gridAutoRows = 'minmax(50px, auto)';
            }

            // Create header cell
            function createHeaderCell(content) {
                const header = document.createElement('div');
                header.textContent = content;
                header.classList.add('header');
                return header;
            }

            // Create time cell
            function createTimeCell(content) {
                const timeColumn = document.createElement('div');
                timeColumn.textContent = content;
                timeColumn.classList.add('time-column');
                return timeColumn;
            }

            // Handle form submission
            submitButton.addEventListener('click', () => {
                const preferences = selectedRoles.map(entry => {
                    const [day, time, role] = entry.split('|');
                    return { day, time, role };
                });

                console.log('Submitted Preferences:', preferences);
                alert('Preferences submitted successfully!');
            });

            // Load roles on page load
            fetchRoles();
        </script>
    </body>
</html>
